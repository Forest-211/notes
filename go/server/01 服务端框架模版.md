# 服务端框架模板

本项目将选用 gin 框架来完成开发，gin 是用 Go 编写的一个 HTTP Web 框架，它具有类似于 Martini 的 API 风格，并且它使用了著名的开源项目 httprouter 的自定义版本作为路由基础，使得它的性能表现更高更好，相较 Martini 大约提高了 40 倍。

另外 gin 除了快以外，还具备小巧、精美且易用的特性，目前广受 Go 语言开发者的喜爱，是最流行的 HTTP Web 框架（从 Github Star 上来看），趋势如下：

![image](https://gitbook-media.oss-ap-southeast-1.aliyuncs.com/pics/gin-stars.jpg)

一般在正式进入业务开发前，我们会针对本次需求的迭代内容进行多类的设计和评审，无设计不开发。但是问题在于，我们目前还缺很多初始化的东西没有做，因此在本章节中，我们主要针对项目目录结构、接口方案、路由注册、数据库等设计进行思考和设计开发。

## 项目结构

```
├── configs         // 配置文件
├── docs						// 文档
├── global					// 全局变量
├── internal				// 内部模块
│   ├── dao					// 数据访问层(Database Access Object)所有与数据相关的操作，如 MySQL、ElasticSearch 等
│   ├── middleware  // HTTP 中间件
│   ├── model				// 模型层
│   ├── routers			// 路由相关逻辑处理
│   └── service			// 项目核心业务逻辑
├── pkg							// 项目相关的模块包
├── storage					// 项目生成的临时文件
├── scripts					// 各类构建，安装，分析等操作的脚本
└── third_party			// 第三方的资源工具，例如 Swagger UI
```



## 初始化项目

```shell
# 创建项目目录
$ mkdir service

# 进入service目录
$ cd service

# 初始化项目mod
$ go mod init service
```

上面命令执行完成后，在项目的根目录就会自动生成一个go.mod文件，其效果图如下：

![image-20220228130228757](https://gitbook-media.oss-ap-southeast-1.aliyuncs.com/pics/image-20220228130228757.png)

### 安装gin

[gin](https://gin-gonic.com/zh-cn/docs/)官网

```shell
$ go get -u github.com/gin-gonic/gin
```

安装完成之后，go.mod文件也会发生相应改变，打开go.mod文件，查看如下：

```go
module service

go 1.17

require (
	github.com/gin-contrib/sse v0.1.0 // indirect
	github.com/gin-gonic/gin v1.7.7 // indirect
	github.com/go-playground/locales v0.14.0 // indirect
	github.com/go-playground/universal-translator v0.18.0 // indirect
	github.com/go-playground/validator/v10 v10.10.0 // indirect
	github.com/golang/protobuf v1.5.2 // indirect
	github.com/json-iterator/go v1.1.12 // indirect
	github.com/leodido/go-urn v1.2.1 // indirect
	github.com/mattn/go-isatty v0.0.14 // indirect
	github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd // indirect
	github.com/modern-go/reflect2 v1.0.2 // indirect
	github.com/ugorji/go/codec v1.2.7 // indirect
	golang.org/x/crypto v0.0.0-20220214200702-86341886e292 // indirect
	golang.org/x/sys v0.0.0-20220227234510-4e6760a101f9 // indirect
	golang.org/x/text v0.3.7 // indirect
	google.golang.org/protobuf v1.27.1 // indirect
	gopkg.in/yaml.v2 v2.4.0 // indirect
)
```

这些就是 gin 所相关联的所有模块包，这里你可能会好奇，为什么 `github.com/gin-gonic/gin` 后面会出现 indirect 标识，它明明是我们直接通过调用 `go get` 引用的，其实不然，是因为在我们安装时，这个项目模块还没有真正的去使用它所导致的（Go modules 会分析项目下的依赖情况来决定)；在 go.mod 文件中有类似 `go 1.17` 这样的标识位，目前来讲暂时没有明确的实际作用，主要与你创建 Go modules 时的 Go 版本有关

### 创建入口程序

完成上面的操作后，接下来就要创建项目的入口程序，在项目的根目录创建一个main.go文件，实例代码如下：

```go
package main

import (
	"net/http"

	"github.com/gin-gonic/gin"
)

func main() {
	r := gin.Default()

	r.GET("/", func(c *gin.Context) {
		c.JSON(http.StatusOK, gin.H{
			"message": "say hi",
		})
	})

	r.Run(":9090")
}
```

然后运行`go run main.go`就可以执行此程序了，然后在浏览器或者postman等工具中访问`localhost:9090`，就会返回如下结果![image-20220228131302295]()
